<script defer>
    //path of page declaration
    var path = window.location.pathname.toString();
    path = path.replace("/customizeMoneyGame", "").replace(/\/id.*/, "");
    //settings from data base
    var settings = '<%-settings%>';
    settings = JSON.parse(settings); //parse to get object


    // game elems declaration
    var progressBar = document.getElementById("progressBar");
    var againBtn = document.getElementById("againBtn");
    var wallet = document.getElementById("wallet");
    var basket = document.getElementById("basket");
 
    var hostName = '<%-host%>';

    // changers declaration
    var nextBackBtnsChanger = document.getElementById("nextBackBtnsChanger");
    var progressBarChanger = document.getElementById("progressBarChanger");
    var againBtnChanger = document.getElementById("againBtnChanger");
    var walletChanger = document.getElementById("walletChanger");
    var basketChanger = document.getElementById("basketChanger");
    var submitBtn = document.getElementById("submitBtn");

    // main part
    switch (path) {
        case "/collectionMoney":
            disableChanger(againBtnChanger);
            disableChanger(basketChanger);
            ////////////////////////////////////////////
            nextBtn.src = settings.nextBtn;
            wallet.src = settings.wallet;
            break;

        case "/selectionGoods":
            disableChanger(againBtnChanger);
            disableChanger(walletChanger);
            ////////////////////////////////////////////
            backBtn.src = settings.backBtn;
            nextBtn.src = settings.nextBtn;
            basket.src = settings.basket;
            break;

        case "/paymentPurchase":
            disableChanger(againBtnChanger);
            disableChanger(basketChanger);
            ////////////////////////////////////////////
            backBtn.src = settings.backBtn;
            nextBtn.src = settings.nextBtn;
            wallet.src = settings.wallet;
            break;

        case "/takeChangee":
            disableChanger(basketChanger);
            ////////////////////////////////////////////
            backBtn.src = settings.backBtn;
            againBtn.src = settings.againBtn;
            wallet.src = settings.wallet;
            break;

        default:
            break;
    }

    //listeners of changers
    nextBackBtnsChanger.addEventListener('change', changePairElems);
    progressBarChanger.addEventListener('change', changeElem);
    againBtnChanger.addEventListener('change', changeElem);
    walletChanger.addEventListener('change', changeElem);
    basketChanger.addEventListener('change', changeElem);

    //input values from DB
    nextBackBtnsChanger.value = getValue(settings.nextBtn);
    progressBarChanger.checked = settings.progressBar;
    againBtnChanger.value = getValue(settings.againBtn);
    walletChanger.value = getValue(settings.wallet);
    basketChanger.value = getValue(settings.basket);

    // get values from URLs
    nextBackBtnsChanger.value = getValue(settings.nextBtn);
    progressBarChanger.checked = settings.progressBar;
    againBtnChanger.value = getValue(settings.againBtn);
    walletChanger.value = getValue(settings.wallet);
    basketChanger.value = getValue(settings.basket);


    showFromDB(progressBarChanger);

    //end of main part

    // function declaration part
    function disableChanger(elem) {
        elem.classList.add("disabled");
        elem.setAttribute("disabled", "disabled");

        var label = elem.parentElement;
        label.classList.add("disabled");
    }

    // change alone element
    function changeElem() {
        if (this.getAttribute('type') == 'checkbox') {
            this.checked ? progressBar.classList.remove('none') : progressBar.classList.add('none');
        }

        else {
            var searchId = this.id.toString().replace('Changer', '');
            var elem = document.getElementById(searchId);

            var imagePath = elem.src;
            imagePath = imagePath.replace(/\w.png/, `${this.value}.png`);
            elem.src = imagePath;
        }
    }

    // change pair elements
    function changePairElems() {
      if (this.id == "nextBackBtnsChanger") {
          var imagePathNextBtn = document.getElementById('nextBtn').src;
          imagePathNextBtn = imagePathNextBtn.replace(/\w.png/, `${nextBackBtnsChanger.value}.png`);
          document.getElementById('nextBtn').src = imagePathNextBtn;

          console.log(imagePathNextBtn + ' imagePathNextBtn');

          var imagePathBackBtn = document.getElementById('backBtn').src;

          console.log(imagePathBackBtn + ' imagePathBackBtn');

          imagePathBackBtn = imagePathBackBtn.replace(/\w.png/, `${nextBackBtnsChanger.value}.png`);
          document.getElementById('backBtn').src = imagePathBackBtn;
        }
    }

    function showFromDB(changer) {
        if (changer.getAttribute('type') == 'checkbox')
            changer.checked ? progressBar.classList.remove('none') : progressBar.classList.add('none');

        else {
            var searchId = changer.id.toString().replace('Changer', '');
            var elem = document.getElementById(searchId);

            var imagePath = elem.src;
            imagePath = imagePath.replace(/\w.png/, `${this.value}.png`);
            elem.src = imagePath;
        }
    }

    function getValue(areaFromDb) {
        var value = areaFromDb.toString();
        value = value.match(/\d.png/)[0];
        value = value.replace('.png', '');

        // console.log(value);

        return parseInt(value);
    }

    submitBtn.onclick = function () {
        var newSettings = {};

        // т.к для этой игры всегда есть кнопка вперед/назад
        if (backBtn.classList.contains('none'))
        {
          var imagePathBackBtn = settings.backBtn.replace(/\w.png/, `${nextBackBtnsChanger.value}.png`);
          newSettings.backBtn = imagePathBackBtn;
        }
        else newSettings.backBtn = backBtn.src.replace(/http(s?):\/\//, '').replace(`${hostName}`, '');

        newSettings.progressBar = progressBarChanger.checked;

        if (nextBtn.classList.contains('none'))
        {
          var imagePathNextBtn = settings.nextBtn.replace(/\w.png/, `${nextBackBtnsChanger.value}.png`);
          newSettings.nextBtn = imagePathNextBtn;
        }
        else newSettings.nextBtn = nextBtn.src.replace(/http(s?):\/\//, '').replace(`${hostName}`, '');

        if (againBtn.classList.contains('none')) newSettings.againBtn = settings.againBtn;
        else newSettings.againBtn = againBtn.src.replace(/http(s?):\/\//, '').replace(`${hostName}`, '');

        if (wallet.classList.contains('none')) newSettings.wallet = settings.wallet;
        else newSettings.wallet = wallet.src.replace(/http(s?):\/\//, '').replace(`${hostName}`, '');

        if (basket.classList.contains('none')) newSettings.basket = settings.basket;
        else newSettings.basket = basket.src.replace(/http(s?):\/\//, '').replace(`${hostName}`, '');


        console.log(newSettings);

        $.ajax({
            type: 'POST',
            url: window.location.pathname,
            dataType: 'json',
            data: newSettings,
            success: console.log('Settings Saved'),
        });
    }
</script>
